; Copyright (c) uib gmbh (www.uib.de)
; This sourcecode is owned by uib
; and published under the Terms of the General Public License.
; credits: http://www.opsi.org/en/credits/

[Actions]
requiredWinstVersion >= "4.11.4.12"
ScriptErrorMessages = False


Message=opsi-client-agent configuration
ShowBitmap "%scriptpath%\uninst\opsi.png" "opsi-client-agent"

DefVar $INST_OS$
DefVar $INST_MinorOS$
DefVar $INST_MSVersion$
DefVar $INST_NTVersion$
DefVar $INST_SystemType$
DefVar $INST_BaseDir$
DefVar $INST_OpsiclientdDir$
DefVar $INST_OpsiclientdConf$
DefVar $productversion$
DefVar $installedversion$
DefVar $packageversion$
DefVar $installedpackage$
DefVar $resultstr$
DefVar $INST_ClientId$
DefVar $ArrayStr$
DefVar $objectStr$
DefVar $kiosk_active$


DefStringlist $INST_ResultList$
DefStringlist $ResultList$


set $INST_OS$ = GetOS

if not($INST_OS$ = "Windows_NT")
	LogError "Wrong OS: Product: opsi-client-agent is only for Windows"
	isFatalError "Wrong OS"
endif

set $INST_Resultlist$ = getProductMap
set $productversion$ = getValue("productversion", $INST_Resultlist$)
set $installedversion$ = getValue("installedversion", $INST_Resultlist$)
set $packageversion$ = getValue("packageversion", $INST_Resultlist$)
set $installedpackage$ = getValue("installedpackage", $INST_Resultlist$)
if not($productversion$ = $installedversion$ and $packageversion$ = $installedpackage$)
	LogError "Update Script do not match installed version - could not Update - Install new version"
	isFatalError "Install new version"
else
	comment "Update Script matches installed version"
endif


set $INST_MinorOS$ = GetNTVersion
set $INST_NTVersion$ = GetMsVersionInfo
Set $INST_SystemType$ = GetSystemType
Set $INST_BaseDir$	= "%ProgramFiles32Dir%\opsi.org\opsi-client-agent"
Set $INST_OpsiclientdDir$   = $INST_BaseDir$+"\opsiclientd"
Set $INST_OpsiclientdConf$ = $INST_OpsiclientdDir$+"\opsiclientd.conf"

Set $INST_ClientId$   = GetvalueFromInifile($INST_OpsiclientdConf$, "global", "host_id", $INST_ClientId$)

sub "%scriptpath%\subconfig.opsiscript"
